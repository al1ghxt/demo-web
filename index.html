<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA | Ultimate Frontend Experience</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,300;1,500;1,700&family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- LIBRARIES (The Heavy Hitters) -->
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Three.js (3D Engine) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GSAP (Animation Engine) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <!-- Lenis (Smooth Scroll) -->
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <style>
        /* ========================================
        CORE VARIABLES
        ========================================
        */
        :root {
            --bg-color: #FAFAF8;
            --text-main: #1A1A1A;
            --text-muted: #4A5568;
            --accent: #C9A96E;
            --accent-glow: rgba(201, 169, 110, 0.4);
            --card-bg: #FFFFFF;
            --border: #E8E5E0;
            --success: #2D6A4F;
            
            --font-serif: 'Playfair Display', serif;
            --font-script: 'Cormorant Garamond', serif;
            --font-hand: 'Dancing Script', cursive;
            --font-sans: 'Inter', sans-serif;
        }

        [data-theme="dark"] {
            --bg-color: #050505;
            --text-main: #F0F0F0;
            --text-muted: #888888;
            --card-bg: #111111;
            --border: #222222;
            --accent: #E0C080;
            --accent-glow: rgba(224, 192, 128, 0.3);
        }

        /* ========================================
        BASE STYLES & RESET
        ========================================
        */
        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        
        html.lenis { height: auto; } 
        .lenis.lenis-smooth { scroll-behavior: auto; } 
        .lenis.lenis-smooth [data-lenis-prevent] { overscroll-behavior: contain; } 
        .lenis.lenis-stopped { overflow: hidden; } 
        .lenis.lenis-scrolling iframe { pointer-events: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-sans);
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
            line-height: 1.6;
        }

        /* Noise Overlay for Texture */
        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9000;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* ========================================
        CUSTOM CURSOR
        ========================================
        */
        .cursor-dot {
            width: 10px; height: 10px;
            background: var(--text-main);
            position: fixed; top: 0; left: 0;
            border-radius: 50%;
            z-index: 9999; pointer-events: none;
            transform: translate(-50%, -50%);
        }
        
        /* The "Follower" will be handled by GSAP for smoothness */
        .cursor-follower {
            width: 40px; height: 40px;
            border: 1px solid var(--accent);
            position: fixed; top: 0; left: 0;
            border-radius: 50%;
            z-index: 9998; pointer-events: none;
            transform: translate(-50%, -50%);
            opacity: 0.6;
            transition: width 0.3s, height 0.3s, background-color 0.3s;
        }

        body.hovering .cursor-follower {
            width: 60px; height: 60px;
            background: var(--accent-glow);
            border-color: transparent;
        }

        /* ========================================
        UI COMPONENTS
        ========================================
        */
        nav {
            position: fixed; top: 0; width: 100%;
            padding: 1.5rem 5%;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        /* Glass effect via backdrop-filter */
        nav::before {
            content: ''; position: absolute; inset: 0;
            background: rgba(250, 250, 248, 0.05); /* Very subtle */
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            z-index: -1;
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        .logo { font-family: var(--font-serif); font-size: 1.5rem; font-weight: 700; text-decoration: none; color: var(--text-main); }
        .nav-links { display: flex; gap: 2.5rem; list-style: none; }
        .nav-links a { text-decoration: none; color: var(--text-main); font-weight: 500; position: relative; }
        .nav-icons { display: flex; gap: 1.5rem; align-items: center; }
        .icon-btn { background: none; border: none; color: var(--text-main); cursor: none; position: relative; }
        
        .cart-count {
            position: absolute; top: -5px; right: -5px;
            background: var(--accent); color: white;
            font-size: 0.7rem; width: 18px; height: 18px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-weight: bold; pointer-events: none;
        }

        /* ========================================
        HERO & 3D CANVAS
        ========================================
        */
        .hero {
            height: 100vh;
            display: grid; grid-template-columns: 1fr 1fr;
            align-items: center; padding: 0 5%;
            position: relative; overflow: hidden;
        }

        .hero-text { z-index: 2; position: relative; }
        .hero h1 { font-size: 5rem; line-height: 1; margin-bottom: 1.5rem; mix-blend-mode: exclusion;}
        .hero-label { font-family: var(--font-script); font-size: 1.5rem; color: var(--accent); display: block; margin-bottom: 1rem; }
        
        .cta-btn {
            display: inline-block; padding: 1rem 2.5rem;
            background: var(--text-main); color: var(--bg-color);
            text-decoration: none; font-weight: 500;
            border: 1px solid var(--text-main);
            overflow: hidden; position: relative;
        }
        
        /* Magnetic Button Effect container */
        .cta-btn span { position: relative; z-index: 2; }
        .cta-btn::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0%; height: 100%;
            background: var(--accent); transition: width 0.4s cubic-bezier(0.19, 1, 0.22, 1); z-index: 1;
        }
        .cta-btn:hover::before { width: 100%; }

        /* The 3D Canvas Container */
        .hero-canvas-container {
            position: absolute; top: 0; right: 0; width: 60%; height: 100%;
            z-index: 1; pointer-events: auto; /* Allow 3D interaction */
        }
        
        #webgl-hero { width: 100%; height: 100%; display: block; }

        /* ========================================
        SECTIONS
        ========================================
        */
        section { padding: 8rem 5%; position: relative; }

        .section-header { text-align: center; margin-bottom: 6rem; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 4rem; }
        
        .product-card {
            opacity: 0; /* Handled by GSAP */
            transform: translateY(50px);
        }

        .product-img-wrap {
            height: 380px; background: #f0f0f0; margin-bottom: 1.5rem;
            overflow: hidden; position: relative;
        }
        
        .product-img-wrap img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 1.2s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .product-card:hover .product-img-wrap img { transform: scale(1.1); }
        
        .add-btn {
            position: absolute; bottom: 0; right: 0; width: 50px; height: 50px;
            background: var(--text-main); color: white; border: none;
            display: flex; align-items: center; justify-content: center;
            transform: translate(100%, 100%); transition: transform 0.4s ease;
        }
        
        .product-card:hover .add-btn { transform: translate(0, 0); }

        /* ========================================
        CART & CHAT UI
        ========================================
        */
        .cart-sidebar {
            position: fixed; top: 0; right: 0; height: 100vh; width: 450px;
            background: var(--card-bg); z-index: 2001;
            transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            border-left: 1px solid var(--border); display: flex; flex-direction: column;
        }
        .cart-sidebar.open { transform: translateX(0); }
        .cart-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); z-index: 2000; opacity: 0; pointer-events: none; transition: 0.5s; }
        .cart-overlay.open { opacity: 1; pointer-events: all; }

        /* AI CHAT & GIFT Styles */
        .chat-trigger {
            position: fixed; bottom: 2rem; right: 2rem;
            width: 60px; height: 60px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center;
            z-index: 9000; transition: transform 0.3s, background 0.3s;
            color: var(--text-main);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .chat-trigger:hover { transform: scale(1.1); background: var(--card-bg); }

        .chat-window {
            position: fixed; bottom: 7rem; right: 2rem;
            width: 380px; height: 500px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            z-index: 8999;
            display: flex; flex-direction: column;
            transform-origin: bottom right;
            transform: scale(0); opacity: 0; pointer-events: none;
            transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
        }
        .chat-window.open { transform: scale(1); opacity: 1; pointer-events: all; }

        .chat-header {
            padding: 1.5rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .chat-messages {
            flex: 1; padding: 1.5rem; overflow-y: auto;
            display: flex; flex-direction: column; gap: 1rem;
        }
        .message {
            max-width: 85%; padding: 0.8rem 1rem; border-radius: 8px;
            font-size: 0.9rem; line-height: 1.5;
        }
        .message.ai {
            background: rgba(0,0,0,0.03); align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .message.user {
            background: var(--text-main); color: var(--bg-color);
            align-self: flex-end; border-bottom-right-radius: 2px;
        }
        
        .chat-input-area {
            padding: 1rem; border-top: 1px solid var(--border);
            display: flex; gap: 0.5rem;
        }
        .chat-input {
            flex: 1; padding: 0.8rem; background: rgba(0,0,0,0.03);
            border: none; outline: none; font-family: var(--font-sans);
            color: var(--text-main);
        }
        .send-btn {
            padding: 0 1rem; background: var(--accent); color: white; border: none;
            display: flex; align-items: center; justify-content: center;
        }

        .gift-section {
            padding: 1.5rem; background: rgba(0,0,0,0.02);
            border-top: 1px solid var(--border);
        }
        .gift-generated {
            font-family: var(--font-hand); font-size: 1.2rem; margin-top: 1rem;
            padding: 1rem; border: 1px dashed var(--accent);
            background: #fff; color: #000;
            display: none;
        }
        .gift-generated.visible { display: block; animation: fadeIn 0.5s; }
        
        /* Loading Animation */
        .typing span {
            display: inline-block; width: 4px; height: 4px;
            background: var(--text-muted); border-radius: 50%;
            margin: 0 2px; animation: dotPulse 1.4s infinite;
        }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotPulse { 0%, 100% { transform: scale(0.5); opacity: 0.5; } 50% { transform: scale(1); opacity: 1; } }

        /* ========================================
        MOBILE
        ========================================
        */
        @media (max-width: 768px) {
            .hero { grid-template-columns: 1fr; padding-top: 6rem; }
            .hero-canvas-container { position: relative; width: 100%; height: 400px; }
            .hero h1 { font-size: 3rem; }
            .cart-sidebar { width: 100%; }
            .nav-links { display: none; }
            .chat-window { width: 90%; right: 5%; bottom: 6rem; }
        }
    </style>
</head>
<body>

    <!-- Texture Overlay -->
    <div class="noise-overlay"></div>

    <!-- Cursors -->
    <div class="cursor-dot"></div>
    <div class="cursor-follower"></div>

    <!-- AI CHAT WIDGET -->
    <button class="chat-trigger sound-click" id="chat-trigger">
        <i data-lucide="sparkles"></i>
    </button>

    <div class="chat-window" id="chat-window">
        <div class="chat-header">
            <span style="font-family: var(--font-serif); font-weight: bold;">Aura Concierge ✨</span>
            <button class="icon-btn sound-hover" id="close-chat"><i data-lucide="x" size="16"></i></button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="message ai">
                Welcome to Aura. I am your personal shopping assistant. How may I elevate your experience today?
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input sound-hover" id="chat-input" placeholder="Ask about products...">
            <button class="send-btn sound-click" id="send-chat"><i data-lucide="arrow-right" size="16"></i></button>
        </div>
    </div>

    <!-- Navigation -->
    <nav>
        <a href="#" class="logo sound-hover">AURA.</a>
        <ul class="nav-links">
            <li><a href="#home" class="sound-hover">Home</a></li>
            <li><a href="#products" class="sound-hover">Collection</a></li>
            <li><a href="#about" class="sound-hover">Philosophy</a></li>
        </ul>
        <div class="nav-icons">
            <button class="icon-btn sound-click" id="theme-toggle"><i data-lucide="moon"></i></button>
            <button class="icon-btn sound-click" id="cart-toggle">
                <i data-lucide="shopping-bag"></i>
                <span class="cart-count">0</span>
            </button>
        </div>
    </nav>

    <!-- Cart -->
    <div class="cart-overlay" id="cart-overlay"></div>
    <aside class="cart-sidebar" id="cart-sidebar">
        <div style="padding: 2rem; border-bottom: 1px solid var(--border); display:flex; justify-content:space-between;">
            <h3>Your Selection</h3>
            <button class="icon-btn sound-hover" id="close-cart"><i data-lucide="x"></i></button>
        </div>
        
        <div id="cart-items" style="flex:1; padding:2rem;"></div>
        
        <!-- AI GIFT NOTE -->
        <div class="gift-section">
            <h4 style="font-family: var(--font-serif); margin-bottom: 0.5rem; display:flex; align-items:center; gap:0.5rem;">
                <i data-lucide="gift" size="14"></i> Bespoke Note ✨
            </h4>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                Describe the recipient and occasion. Our AI will craft the perfect message.
            </p>
            <textarea id="gift-prompt" class="chat-input" rows="2" placeholder="E.g., For my business partner celebrating a merger..."></textarea>
            <button class="cta-btn sound-click" id="generate-note" style="width:100%; margin-top:0.5rem; padding: 0.5rem; font-size: 0.8rem;">
                <span>Draft Note</span>
            </button>
            <div id="gift-result" class="gift-generated"></div>
        </div>

        <div style="padding: 2rem; border-top: 1px solid var(--border);">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;">
                <span>Total</span>
                <span id="cart-total">$0.00</span>
            </div>
            <button class="cta-btn sound-click" style="width:100%; text-align:center;"><span>Checkout</span></button>
        </div>
    </aside>

    <main>
        <!-- Hero with Three.js -->
        <section id="home" class="hero">
            <div class="hero-text">
                <span class="hero-label reveal-text">Elevate Your</span>
                <h1 class="reveal-text">Future <br><span class="text-accent" style="font-family: var(--font-script);">Esthetique</span></h1>
                <p class="reveal-text" style="margin-bottom: 2rem; max-width: 400px; color: var(--text-muted);">
                    Curated essentials for the modern visionary. Where data meets uncompromising design.
                </p>
                <a href="#products" class="cta-btn sound-hover reveal-text"><span>Explore Collection</span></a>
            </div>
            <div class="hero-canvas-container">
                <canvas id="webgl-hero"></canvas>
            </div>
        </section>

        <!-- Products -->
        <section id="products">
            <div class="section-header">
                <span class="hero-label">Curated Selection</span>
                <h2>The Collection</h2>
            </div>
            <div class="products-grid" id="products-grid">
                <!-- Injected via JS -->
            </div>
        </section>

        <!-- About -->
        <section id="about" style="min-height: 50vh; display:flex; align-items:center; justify-content:center; text-align:center;">
            <div style="max-width: 600px;">
                <span class="hero-label">Philosophy</span>
                <h2 style="font-size: 3rem; margin-bottom: 2rem;">"Simplicity is the ultimate sophistication."</h2>
                <p class="text-muted">We believe in objects that serve a purpose and tell a story.</p>
            </div>
        </section>
    </main>

    <script>
        // ============================================
        // 1. GEMINI API & AI FEATURES
        // ============================================
        const apiKey = "AIzaSyDzGrKL6oRBbzwaaThcm3ac-qN5cOV0ePs"; // Injected by environment

        async function callGemini(prompt, systemInstruction = "") {
            if (!apiKey) {
                alert("Please add your Gemini API Key in the code to use AI features.");
                return "API Key missing.";
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('API Error');
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return "Aura is currently meditating. Please try again later.";
            }
        }

        // ============================================
        // 2. AUDIO SYNTHESIZER
        // ============================================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'hover') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.15);
            }
        }

        document.addEventListener('mouseover', (e) => {
            if(e.target.closest('.sound-hover')) playSound('hover');
        });
        document.addEventListener('mousedown', (e) => {
            if(e.target.closest('.sound-click')) playSound('click');
        });

        // ============================================
        // 3. SMOOTH SCROLL (Lenis)
        // ============================================
        const lenis = new Lenis({
            duration: 1.2,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            direction: 'vertical',
            gestureDirection: 'vertical',
            smooth: true,
            mouseMultiplier: 1,
            smoothTouch: false,
            touchMultiplier: 2,
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }
        requestAnimationFrame(raf);

        // ============================================
        // 4. THREE.JS (The Holographic Crystal)
        // ============================================
        const initThreeJS = () => {
            const canvas = document.querySelector('#webgl-hero');
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            // Geometry: Holographic Icosahedron
            const geometry = new THREE.IcosahedronGeometry(2, 0);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xC9A96E, 
                wireframe: true,
                transparent: true,
                opacity: 0.3
            });
            const crystal = new THREE.Mesh(geometry, material);
            
            // Inner Core
            const coreGeo = new THREE.OctahedronGeometry(1, 0);
            const coreMat = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true });
            const core = new THREE.Mesh(coreGeo, coreMat);
            crystal.add(core);

            // Particles
            const particlesGeo = new THREE.BufferGeometry();
            const particlesCount = 200;
            const posArray = new Float32Array(particlesCount * 3);
            for(let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 10;
            }
            particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const particlesMat = new THREE.PointsMaterial({
                size: 0.05,
                color: 0xC9A96E,
                transparent: true,
                opacity: 0.8
            });
            const particlesMesh = new THREE.Points(particlesGeo, particlesMat);
            scene.add(particlesMesh);

            scene.add(crystal);

            // Mouse Interaction
            let mouseX = 0;
            let mouseY = 0;
            let targetX = 0;
            let targetY = 0;

            const windowHalfX = window.innerWidth / 2;
            const windowHalfY = window.innerHeight / 2;

            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - windowHalfX);
                mouseY = (event.clientY - windowHalfY);
            });

            // Animation Loop
            const clock = new THREE.Clock();

            const animate = () => {
                targetX = mouseX * 0.001;
                targetY = mouseY * 0.001;

                const elapsedTime = clock.getElapsedTime();

                // Rotate Crystal
                crystal.rotation.y += 0.5 * (targetX - crystal.rotation.y);
                crystal.rotation.x += 0.05 * (targetY - crystal.rotation.x);
                crystal.rotation.z += 0.002;

                // Breathe effect
                const scale = 1 + Math.sin(elapsedTime) * 0.05;
                crystal.scale.set(scale, scale, scale);

                // Rotate Particles
                particlesMesh.rotation.y = -elapsedTime * 0.1;

                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            };

            animate();

            // Handle Resize
            window.addEventListener('resize', () => {
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            });
        };

        // ============================================
        // 5. GSAP ANIMATIONS
        // ============================================
        const initAnimations = () => {
            gsap.registerPlugin(ScrollTrigger);

            // Hero Text Stagger
            gsap.from('.reveal-text', {
                y: 100,
                opacity: 0,
                duration: 1.5,
                stagger: 0.2,
                ease: 'power4.out',
                delay: 0.5
            });

            // Product Cards Reveal
            gsap.utils.toArray('.product-card').forEach((card, i) => {
                gsap.to(card, {
                    scrollTrigger: {
                        trigger: card,
                        start: 'top 85%',
                    },
                    y: 0,
                    opacity: 1,
                    duration: 1,
                    ease: 'power3.out',
                    delay: i * 0.1 // Stagger effect
                });
            });

            // Smooth Cursor Follower
            const follower = document.querySelector('.cursor-follower');
            const dot = document.querySelector('.cursor-dot');
            
            window.addEventListener('mousemove', (e) => {
                gsap.to(dot, { x: e.clientX, y: e.clientY, duration: 0 });
                gsap.to(follower, { x: e.clientX, y: e.clientY, duration: 0.5, ease: 'power2.out' });
                
                // Check hover state
                if (e.target.closest('a, button, .sound-hover')) {
                    document.body.classList.add('hovering');
                } else {
                    document.body.classList.remove('hovering');
                }
            });
        };

        // ============================================
        // 6. APPLICATION LOGIC (Cart & Products)
        // ============================================
        const products = [
            { id: 1, name: "Executive Portfolio", price: 89, cat: "Office", img: "https://images.unsplash.com/photo-1544816155-12df9643f363?auto=format&fit=crop&q=80&w=600" },
            { id: 2, name: "Neural Link Headset", price: 299, cat: "Tech", img: "https://images.unsplash.com/photo-1590658268037-6bf12165a8df?auto=format&fit=crop&q=80&w=600" },
            { id: 3, name: "Quantum Dock", price: 150, cat: "Tech", img: "https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?auto=format&fit=crop&q=80&w=600" },
            { id: 4, name: "Obsidian Pen", price: 65, cat: "Tools", img: "https://images.unsplash.com/photo-1585336261022-680e295ce3fe?auto=format&fit=crop&q=80&w=600" },
            { id: 5, name: "Analog Timepiece", price: 450, cat: "Wear", img: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&q=80&w=600" },
            { id: 6, name: "Slate Organizer", price: 75, cat: "Office", img: "https://images.unsplash.com/photo-1516961642265-531546e84af2?auto=format&fit=crop&q=80&w=600" }
        ];

        const productsGrid = document.getElementById('products-grid');
        
        products.forEach(p => {
            const div = document.createElement('div');
            div.className = 'product-card';
            div.innerHTML = `
                <div class="product-img-wrap sound-hover">
                    <img src="${p.img}" alt="${p.name}">
                    <button class="add-btn sound-click" onclick="addToCart(${p.id})"><i data-lucide="plus"></i></button>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div>
                        <span class="text-accent" style="font-size:0.8rem; text-transform:uppercase;">${p.cat}</span>
                        <h3 style="font-family:var(--font-serif); font-size:1.2rem;">${p.name}</h3>
                    </div>
                    <span>$${p.price}</span>
                </div>
            `;
            productsGrid.appendChild(div);
        });

        // Cart Logic
        let cart = [];
        const updateCart = () => {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.querySelector('.cart-count');
            
            container.innerHTML = cart.map(item => `
                <div style="display:flex; gap:1rem; margin-bottom:1rem; align-items:center;">
                    <img src="${item.img}" style="width:50px; height:50px; object-fit:cover;">
                    <div style="flex:1;">
                        <div style="font-weight:bold;">${item.name}</div>
                        <div class="text-muted">$${item.price}</div>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((acc, item) => acc + item.price, 0);
            totalEl.innerText = `$${total.toFixed(2)}`;
            countEl.innerText = cart.length;
        }

        window.addToCart = (id) => {
            const prod = products.find(p => p.id === id);
            cart.push(prod);
            updateCart();
            playSound('click');
            
            // GSAP Cart Bounce
            gsap.fromTo('.cart-count', { scale: 1.5 }, { scale: 1, duration: 0.5, ease: 'elastic.out(1, 0.3)' });
            
            document.getElementById('cart-sidebar').classList.add('open');
            document.getElementById('cart-overlay').classList.add('open');
        }

        // Toggle Events
        document.getElementById('cart-toggle').onclick = () => {
            document.getElementById('cart-sidebar').classList.add('open');
            document.getElementById('cart-overlay').classList.add('open');
        }
        const closeCart = () => {
            document.getElementById('cart-sidebar').classList.remove('open');
            document.getElementById('cart-overlay').classList.remove('open');
        }
        document.getElementById('close-cart').onclick = closeCart;
        document.getElementById('cart-overlay').onclick = closeCart;

        document.getElementById('theme-toggle').onclick = () => {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }

        // --- Chat Widget Logic ---
        const chatTrigger = document.getElementById('chat-trigger');
        const chatWindow = document.getElementById('chat-window');
        const closeChat = document.getElementById('close-chat');
        const chatInput = document.getElementById('chat-input');
        const sendChat = document.getElementById('send-chat');
        const chatMessages = document.getElementById('chat-messages');

        chatTrigger.addEventListener('click', () => {
            chatWindow.classList.add('open');
            chatTrigger.style.transform = 'scale(0)';
            playSound('click');
        });

        closeChat.addEventListener('click', () => {
            chatWindow.classList.remove('open');
            chatTrigger.style.transform = 'scale(1)';
            playSound('click');
        });

        async function handleChat() {
            const userText = chatInput.value.trim();
            if(!userText) return;

            // Add User Message
            addMessage(userText, 'user');
            chatInput.value = '';

            // Loading
            const loadingId = addLoading();

            // Context
            const catalog = JSON.stringify(products.map(p => `${p.name} ($${p.price}, ${p.cat})`));
            const systemPrompt = `You are Aura, a luxury shopping concierge. Your tone is minimalist, sophisticated, and helpful. You have access to this catalog: ${catalog}. Recommend items from the catalog. Keep responses under 50 words.`;

            // Call API
            const response = await callGemini(userText, systemPrompt);
            
            // Remove loading and add response
            removeLoading(loadingId);
            addMessage(response, 'ai');
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerText = text;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoading() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.className = 'message ai typing';
            div.id = id;
            div.innerHTML = '<span></span><span></span><span></span>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if(el) el.remove();
        }

        sendChat.addEventListener('click', handleChat);
        chatInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') handleChat();
        });

        // --- Gift Note Logic ---
        const giftBtn = document.getElementById('generate-note');
        const giftPrompt = document.getElementById('gift-prompt');
        const giftResult = document.getElementById('gift-result');

        giftBtn.addEventListener('click', async () => {
            const prompt = giftPrompt.value;
            if(!prompt) return;

            giftBtn.innerText = "Drafting...";
            
            const systemPrompt = "Write a short, elegant, handwritten-style gift note (max 25 words). Tone: Sincere and Premium.";
            const note = await callGemini(`Write a note for: ${prompt}`, systemPrompt);
            
            giftResult.innerText = note;
            giftResult.classList.add('visible');
            giftBtn.innerText = "Regenerate";
            playSound('click');
        });

        // Init Everything
        window.onload = () => {
            lucide.createIcons();
            initThreeJS();
            initAnimations();
        };

    </script>
</body>
</html>
